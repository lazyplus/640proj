package paxosproto

import (
	"net/rpc"
	"sync"
)

const (
	PREPARE = iota
	PREPARE_OK
	PREPARE_BEHIND
	PREPARE_REJECT
	ACCEPT
	ACCEPT_OK
	ACCEPT_REJECT
	COMMIT
)

const (
	C_QueryFlights = iota
	C_PrepareBookFlight
	C_PrepareCancelFlight
	C_BookDecision
	C_CancelDecision
	C_DeleteFlight
	C_RescheduleFlight
	C_AddFlight
)

const (
	Propose_OK = iota
	Propose_RETRY
	Propose_FAIL
)

type NodeStruct struct {
	Port string 
	ID int	
}

type RPCStruct struct {
	in chan * Packet
}

type PaxosEngine struct {
	numNodes int
    log map[int] *ValueStruct
    clients []*rpc.Client
    servers []*NodeStruct
    cur_seq int
    cur_paxos PaxosInstance
    mutex sync.Mutex
    in chan * MsgStruct
    out chan * Packet
    brd chan * Packet
	prog chan * Packet
	exitCurrentPI chan int
	exitThisEngine chan int
    peerID int
    // network
    RPCReceiver * RPCStruct
}

type ValueStruct struct {
    CoordSeq int
    Type int
    Action interface{}
    reply interface{}
    Host string
}

type replyStruct struct {
	reply interface{}
	Type int
	Status int
}

type Packet struct {
    PeerID int
    Msg * MsgStruct
}

type PaxosInstance struct {
	log map[int] *ValueStruct
    out chan * Packet
    brd chan * Packet
    in chan * MsgStruct
    prog chan * Packet
    prepareCh chan * MsgStruct
    acceptCh chan * MsgStruct
    shouldExit chan int
	Na int
	Nh int
	Myn int
	Va ValueStruct
    seq int
    PeerID int
    numNodes int
    PreaccepteNodes int
    PrefailNodes int
    AcpacceptedNodes int
    AcpfailNodes int
    running bool
}

type MsgStruct struct {
    Seq int
    Type int
    Na int
    Myn int
    Va ValueStruct
}

